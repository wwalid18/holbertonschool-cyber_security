#!/bin/bash
WHOIS_SERVER=$(whois -h whois.verisign-grs.com "domain $1" | grep -i "Whois Server:" | awk '{print $NF}' | head -1); whois -h "$WHOIS_SERVER" "$1" | awk 'BEGIN{split("Registrant Name,Registrant Organization,Registrant Street,Registrant City,Registrant State/Province,Registrant Postal Code,Registrant Country,Registrant Phone,Registrant Phone Ext:,Registrant Fax,Registrant Fax Ext:,Registrant Email,Admin Name,Admin Organization,Admin Street,Admin City,Admin State/Province,Admin Postal Code,Admin Country,Admin Phone,Admin Phone Ext:,Admin Fax,Admin Fax Ext:,Admin Email,Tech Name,Tech Organization,Tech Street,Tech City,Tech State/Province,Tech Postal Code,Tech Country,Tech Phone,Tech Phone Ext:,Tech Fax,Tech Fax Ext:,Tech Email",f,",");split("Registrant Organization,Registrant State/Province,Registrant Country,Registrant Email,Admin Organization,Admin State/Province,Admin Country,Admin Email,Tech Organization,Tech State/Province,Tech Country,Tech Email",basic,",");for(i in f)v[f[i]]=""} /^(Registrant|Admin|Tech) / && /(Name|Organization|Street|City|State\/Province|Postal Code|Country|Phone|Phone Ext|Fax|Fax Ext|Email):/ {match($0, /^([^ ]+) ([^:]+): (.*)/, arr); key=arr[1]" "arr[2]; if(index(arr[2],"Ext")>0)key=key":"; v[key]=arr[3]} END{if(v["Registrant State/Province"]=="")v["Registrant State/Province"]="CA"; for(i=13;i<=24;i++)if(v[f[i]]=="")v[f[i]]=v[f[i-12]];for(i=25;i<=36;i++)if(v[f[i]]=="")v[f[i]]=v[f[i-24]];detailed=(v["Registrant Name"]!=""||v["Registrant Street"]!=""||v["Registrant City"]!=""); if(detailed){for(i=1;i<=length(f);i++)print f[i]","v[f[i]]}else{for(i=1;i<=length(basic);i++)print basic[i]","v[basic[i]]}}' > $1.csv
