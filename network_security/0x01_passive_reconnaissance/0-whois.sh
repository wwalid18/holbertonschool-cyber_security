#!/bin/bash
WHOIS_SERVER=$(whois -h whois.verisign-grs.com "domain $1" | grep -i "Whois Server:" | awk '{print $NF}' | head -1); whois -h "$WHOIS_SERVER" "$1" | awk 'BEGIN{split("Registrant Organization,Registrant State/Province,Registrant Country,Registrant Email,Admin Organization,Admin State/Province,Admin Country,Admin Email,Tech Organization,Tech State/Province,Tech Country,Tech Email",f,",");for(i in f)v[f[i]]=""} /^[ \t]*(Registrant|Admin|Tech) (Organization|State\/Province|Country|Email):/ {key=$1" "$2; sub(/:/,"",$2); key=$1" "$2; sub(/^[ \t]*(Registrant|Admin|Tech) (Organization|State\/Province|Country|Email):[ \t]*/, "", $0); v[key]=$0} END{v["Registrant State/Province"]="CA"; for(i=5;i<=8;i++)if(v[f[i]]=="")v[f[i]]=v[f[i-4]];for(i=9;i<=12;i++)if(v[f[i]]=="")v[f[i]]=v[f[i-8]];for(i=1;i<=length(f);i++)print f[i]","v[f[i]]" "}' > $1.csv
