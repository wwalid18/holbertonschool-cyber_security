#!/bin/bash
whois $1 | awk 'BEGIN{split("Registrant Organization,Registrant State/Province,Registrant Country,Registrant Email,Admin Organization,Admin State/Province,Admin Country,Admin Email,Tech Organization,Tech State/Province,Tech Country,Tech Email",f,",");for(i in f)v[f[i]]=""} /^[ \t]*(Registrant|Admin|Tech) (Organization|State\/Province|Country|Email)[ \t]*:/ {key=$1" "$2; sub(/^[ \t]*/,"",key); sub(/[ \t]*:.*$/,"",$0); match($0,/^[ \t]*(Registrant|Admin|Tech) (Organization|State\/Province|Country|Email)[ \t]*: ?(.*)$/,a); v[a[1]" "a[2]]=a[3]} END{for(i=5;i<=8;i++)if(v[f[i]]=="")v[f[i]]=v[f[i-4]];for(i=9;i<=12;i++)if(v[f[i]]=="")v[f[i]]=v[f[i-8]];for(i=1;i<=length(f);i++)print f[i]","v[f[i]]}' > $1.csv
